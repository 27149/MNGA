syntax = "proto3";

message Topic {
  string id = 1;
  repeated string tags = 8;
  string subject_content = 9;
  string author_id = 3;
  string author_name = 4;
  uint64 post_date = 5;
  uint64 last_post_date = 6;
  uint32 replies_num = 7;
  optional Forum parent_forum = 10;
}

message User {
  string id = 1;
  string name = 2;
  string avatar_url = 3;
  uint64 reg_date = 4;
  uint32 post_num = 5;
  sint64 fame = 6;
}

message PostId {
  string pid = 1;
  string tid = 2;
}

message Post {
  enum Device {
    OTHER = 0;
    APPLE = 1;
    ANDROID = 2;
  }

  PostId id = 6;
  uint32 floor = 1;
  string author_id = 2;
  PostContent content = 3;
  uint64 post_date = 4;
  uint32 score = 5;
  VoteState vote_state = 7;
  repeated Post host_replies = 8;
  Device device = 9;
}

message Subforum {
  Forum forum = 8;
  string filter_id = 7;
  uint64 attributes = 4;
  bool filterable = 5;
  bool selected = 6;
}

message Category {
  string id = 1;
  string name = 2;
  repeated Forum forums = 3;
}

message ForumId {
  oneof id {
    string fid = 1;
    string stid = 2;
  }
}

message Forum {
  ForumId id = 1;
  string name = 2;
  string info = 3;
  string icon_url = 4;
}

message Span {
  message Plain { string text = 1; }
  message BreakLine {}
  message Sticker { string name = 1; }
  message Tagged {
    string tag = 1;
    repeated string attributes = 2;
    repeated Span spans = 3;
  }

  oneof value {
    Plain plain = 1;
    BreakLine break_line = 2;
    Sticker sticker = 3;
    Tagged tagged = 4;
  }
}

message PostContent {
  repeated Span spans = 1;
  string raw = 2;
}

message Configuration { string document_dir_path = 1; }

message AuthInfo {
  string uid = 1;
  string token = 2;
}

enum VoteState {
  NONE = 0;
  UP = 1;
  DOWN = 2;
}

message TopicSnapshot {
  Topic topic_snapshot = 1;
  uint64 timestamp = 2;
}
